{"version":3,"sources":["app.js","controllers/buildings.js","controllers/game.js","controllers/log.js","controllers/resources.js","filters/numeric.js","services/storage.js","values/buildings.js","values/game.js","values/resources.js"],"names":["angular","module","constant","TICK_RATE","SAVE_RATE","SAVE_LOCATION","config","$routeProvider","when","templateUrl","otherwise","redirectTo","controller","Buildings","Resources","unlockBuildings","forEach","bld","locked","requires","resources","rres","rrkey","res","rkey","value","current","this","getPrices","key","incr","Math","pow","increase","req","price","buynow","affordable","name","isBuyable","buyable","getAll","buy","provides","prov","pkey","rate","$interval","Defaults","Game","Storage","tickloop","ticks","limit","min","load","save","filter","units","number","precision","n","u","floor","log","p","toFixed","service","console","version","game","buildings","localStorage","setItem","JSON","stringify","err","error","parse","getItem","collect","description","max","level","flowers","meadow"],"mappings":"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","file":"munchkins.js","sourcesContent":["'use strict';\n\nangular\n  .module('munchkins', ['ngRoute'])\n  .constant('Defaults', {\n    TICK_RATE: 250,\n    SAVE_RATE: 60000,\n    SAVE_LOCATION: 'munchkinsSave'\n  })\n  .config(function($routeProvider) {\n    $routeProvider\n      .when('/buildings', { templateUrl: 'views/buildings.html' })\n      .otherwise({ redirectTo: '/buildings' });\n  });\n","angular\n  .module('munchkins')\n  .controller('Buildings', function(Buildings, Resources) {\n    const unlockBuildings = function() {\n      angular.forEach(Buildings, function(bld) {\n        if (bld.locked) {\n          bld.locked = false;\n          angular.forEach(bld.requires.resources, function(rres, rrkey) {\n            if (!bld.locked) {\n              angular.forEach(Resources, function(res, rkey) {\n                if (rkey === rrkey) {\n                  bld.locked = !(res.value.current >= rres.value);\n                }\n              });\n            }\n          });\n        }\n      });\n    };\n\n    this.getPrices = function(key) {\n      const incr = Math.pow(Buildings[key].increase, Buildings[key].value.current);\n\n      angular.forEach(Buildings[key].requires.resources, function(req, rkey) {\n        const price = req.value * incr;\n\n        req.buynow = price;\n        req.affordable = Resources[rkey].value.current >= price;\n        req.name = Resources[rkey].name;\n      });\n\n      return Buildings[key].requires.resources;\n    };\n\n    this.isBuyable = function(key) {\n      const incr = Math.pow(Buildings[key].increase, Buildings[key].value.current);\n      let buyable = true;\n\n      angular.forEach(Buildings[key].requires.resources, function(req, rkey) {\n        buyable = buyable && (Resources[rkey].value.current >= req.value * incr);\n      });\n\n      return buyable;\n    };\n\n    this.getAll = function() {\n      return Buildings;\n    };\n\n    this.buy = function(key) {\n      if (!this.isBuyable(key)) {\n        return;\n      }\n\n      const incr = Math.pow(Buildings[key].increase, Buildings[key].value.current);\n\n      Buildings[key].value.current++;\n\n      angular.forEach(Buildings[key].requires.resources, function(req, rkey) {\n        Resources[rkey].value.current -= req.value * incr;\n      });\n\n      angular.forEach(Buildings[key].provides.resources, function(prov, pkey) {\n        Resources[pkey].value.current++;\n        Resources[pkey].rate += prov.rate;\n      });\n\n      unlockBuildings();\n    };\n\n    angular.forEach(Buildings, function(bld) {\n      angular.forEach(bld.provides.resources, function(prov, pkey) {\n        Resources[pkey].rate += bld.value.current * prov.rate;\n      });\n    });\n  });\n","angular\n  .module('munchkins')\n  .controller('Game', function($interval, Defaults, Game, Buildings, Resources, Storage) {\n    const tickloop = function() {\n      Game.ticks++;\n\n      angular.forEach(Resources, function(res) {\n        res.value.current += res.rate;\n        if (res.value.limit) {\n          res.value.current = Math.min(res.value.current, res.value.limit);\n        }\n      });\n    };\n\n    Storage.load();\n\n    $interval(Storage.save, Defaults.SAVE_RATE);\n    $interval(tickloop, Defaults.TICK_RATE);\n  });\n","angular\n  .module('munchkins')\n  .controller('Log', function() {});\n","angular\n  .module('munchkins')\n  .controller('Resources', function(Resources) {\n    this.resources = Resources;\n  });\n","angular\n  .module('munchkins')\n  .filter('numeric', function() {\n    const units = ['', 'K', 'M', 'G', 'T', 'P'];\n\n    return function(number, precision) {\n      const n = number || 0;\n      const u = Math.floor(Math.log(n) / Math.log(1000));\n\n      let p = precision || ((precision === 0) ? 0 : 2);\n      if ((p === 0) && (p >= 1000)) {\n        p = 2;\n      }\n\n      return (u < 0) ? (n.toFixed(p)) : ((n / 1000 ** Math.floor(u)).toFixed(p) + units[u]);\n    };\n  });\n","angular\n  .module('munchkins')\n  .service('Storage', function($interval, Defaults, Game, Resources, Buildings) {\n    this.save = function() {\n      console.log('Saving game');\n      try {\n        const save = {\n          version: 1,\n          game: {},\n          resources: {},\n          buildings: {}\n        };\n\n        save.game.ticks = Game.ticks;\n\n        angular.forEach(Resources, function(res, key) {\n          save.resources[key] = {\n            value: res.value\n          };\n        });\n\n        angular.forEach(Buildings, function(bld, key) {\n          save.buildings[key] = {\n            value: bld.value,\n            locked: bld.locked\n          };\n        });\n\n        localStorage.setItem(Defaults.SAVE_LOCATION, JSON.stringify(save));\n      } catch(err) {\n        console.error(err);\n      }\n    };\n\n    this.load = function() {\n      console.log('Loading game');\n      try {\n        const load = JSON.parse(localStorage.getItem(Defaults.SAVE_LOCATION));\n\n        load.game = load.game || {};\n        load.resources = load.resources || {};\n        load.buildings = load.buildings || {};\n\n        Game.ticks = load.game.ticks || Game.ticks;\n\n        angular.forEach(load.resources, function(res, key) {\n          Resources[key].value = res.value;\n        });\n\n        angular.forEach(load.buildings, function(bld, key) {\n          Buildings[key].value = bld.value;\n          Buildings[key].locked = bld.locked;\n        });\n      } catch (err) {\n        console.error(err);\n      }\n    };\n  });\n","/*\n  Buildings are defined with the following structure\n\n  <key>: {\n    name: <string name>\n    description: <string description>\n    unlocked: <true|false>\n    increase: <base price increase>\n    value: {\n      current: <current value>\n      limit: <max value, 0 if no limit>\n      level: <upgrade level>\n    }\n    requires: {\n      resources: {\n        <resource key>: {\n          value: <number>\n        }\n      }\n    }\n    provides: {\n      resources: {\n        <resource key>: {\n          value: <number>\n          rate: <number>\n        }\n      }\n    }\n  }\n*/\nangular\n  .module('munchkins')\n  .value('Buildings', {\n    collect: {\n      name: 'Collect Flowers',\n      description: 'Flowers are the staple of the Munchkin diet, collect them',\n      locked: false,\n      increase: 0,\n      value: {\n        current: 0,\n        max: 0,\n        level: 0\n      },\n      requires: {\n      },\n      provides: {\n        resources: {\n          flowers: {\n            value: 1,\n            rate: 0\n          }\n        }\n      }\n    },\n    meadow: {\n      name: 'Flower Meadow',\n      description: 'A naturally gorwing field of flowers',\n      locked: true,\n      increase: 1.1,\n      value: {\n        current: 0,\n        max: 0,\n        level: 0\n      },\n      requires: {\n        resources: {\n          flowers: {\n            value: 100\n          }\n        }\n      },\n      provides: {\n        resources: {\n          flowers: {\n            value: 0,\n            rate: 0.01\n          }\n        }\n      }\n    }\n  });\n","angular\n  .module('munchkins')\n  .value('Game', {\n    ticks: 0\n  });\n","/*\n  Resources are defined with the following structure\n\n  <key>: {\n    name: <string name>\n    description: <string description>\n    value: {\n      current: <current value>\n      max: <max value>\n    }\n    rate: <rate of increase>\n  }\n*/\nangular\n  .module('munchkins')\n  .value('Resources', {\n    flowers: {\n      name: 'Flowers',\n      description: 'Flowers are the staple of the Munchkin diet',\n      value: {\n        current: 0,\n        limit: 0\n      },\n      rate: 0\n    }\n  });\n"],"sourceRoot":"."}