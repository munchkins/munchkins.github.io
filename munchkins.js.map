{"version":3,"sources":["app.js","controllers/buildings.js","controllers/crafting.js","controllers/game.js","controllers/log.js","controllers/resources.js","filters/numeric.js","services/actions.js","services/buildings.js","services/crafting.js","services/game.js","services/resources.js","services/storage.js"],"names":[],"mappings":"AAAA;;AAEA,QACG,OAAO,aAAa,CAAC,YACrB,SAAS,YAAY;EACpB,WAAW;EACX,WAAW;EACX,eAAe;GAEhB,0BAAO,UAAS,gBAAgB;EAC/B,eACG,KAAK,cAAc,EAAE,aAAa,0BAClC,UAAU,EAAE,YAAY;IAC1B;ACbL;;AAAA,QACG,OAAO,aACP,WAAW,sCAAa,UAAS,SAAS,WAAW;EACpD,KAAK,YAAY,UAAU;;EAE3B,KAAK,MAAM,QAAQ;EACnB,KAAK,YAAY,QAAQ;EACzB,KAAK,SAAS,QAAQ;IACrB;ACRL;;AAAA,QACG,OAAO,aACP,WAAW,oCAAY,UAAS,SAAS,UAAU;EAClD,KAAK,WAAW,SAAS;;EAEzB,KAAK,MAAM,QAAQ;EACnB,KAAK,YAAY,QAAQ;EACzB,KAAK,SAAS,QAAQ;IACrB;ACRL;;AAAA,QACG,OAAO,aACP,WAAW,6EAAQ,UAAS,WAAW,UAAU,MAAM,SAAS,WAAW,SAAS;EACnF,IAAM,WAAW,SAAX,WAAsB;IAC1B,KAAK,MAAM;;IAEX,IAAM,YAAY,UAAU;IAC5B,EAAE,QAAQ,WAAW,UAAS,UAAU;MACtC,SAAS,MAAM,WAAW,SAAS;MACnC,IAAI,SAAS,MAAM,OAAO;QACxB,SAAS,MAAM,UAAU,KAAK,IAAI,SAAS,MAAM,SAAS,SAAS,MAAM;;;;;EAK/E,QAAQ;EACR,QAAQ;;EAER,UAAU,QAAQ,MAAM,SAAS;EACjC,UAAU,UAAU,SAAS;IAC5B;ACpBL;;AAAA,QACG,OAAO,aACP,WAAW,OAAO,YAAW,IAAI;ACFpC;;AAAA,QACG,OAAO,aACP,WAAW,2BAAa,UAAS,WAAW;EAC3C,KAAK,YAAY,UAAU;IAC1B;ACJL;;AAAA,QACG,OAAO,aACP,OAAO,WAAW,YAAW;EAC5B,IAAM,QAAQ,CAAC,IAAI,KAAK,KAAK,KAAK,KAAK;;EAEvC,OAAO,UAAS,QAAQ,WAAW;IACjC,IAAM,IAAI,UAAU;IACpB,IAAM,IAAI,KAAK,MAAM,KAAK,IAAI,KAAK,KAAK,IAAI;;IAE5C,IAAI,IAAI,cAAe,cAAc,IAAK,IAAI;IAC9C,IAAK,MAAM,KAAO,KAAK,MAAO;MAC5B,IAAI;;;IAGN,OAAO,IAAK,IAAM,EAAE,QAAQ,KAAO,CAAC,IAAC,KAAA,IAAG,MAAQ,KAAK,MAAM,KAAI,QAAQ,KAAK,MAAM;;GAEnF;AChBL;;AAAA,QACG,OAAO,aACP,QAAQ,kDAAW,UAAS,WAAW,UAAU,WAAW;EAC3D,IAAM,YAAY,SAAZ,YAAuB;IAC3B,IAAM,SAAS,SAAT,OAAkB,WAAW;MACjC,EAAE,QAAQ,WAAW,UAAS,UAAU;QACtC,IAAI,SAAS,QAAQ;UACnB,SAAS,SAAS;;UAElB,EAAE,QAAQ,SAAS,SAAS,WAAW,UAAS,GAAG,GAAG;YACpD,IAAI,CAAC,SAAS,QAAQ;cACpB,SAAS,SAAS,EAAE,UAAU,IAAI,GAAG,MAAM,WAAW,EAAE;;;;UAI5D,EAAE,QAAQ,SAAS,SAAS,WAAW,UAAS,GAAG,GAAG;YACpD,IAAI,CAAC,SAAS,QAAQ;cACpB,SAAS,SAAS,EAAE,UAAU,IAAI,GAAG,MAAM,WAAW,EAAE;;;;;;;IAOlE,OAAO,UAAU;IACjB,OAAO,SAAS;;;EAGlB,KAAK,YAAY,UAAS,UAAU;IAClC,IAAM,OAAO,KAAK,IAAI,SAAS,UAAU,SAAS,MAAM;IACxD,IAAI,UAAU;;IAEd,EAAE,QAAQ,SAAS,SAAS,WAAW,UAAS,GAAG,GAAG;MACpD,IAAI,SAAS;QACX,UAAU,UAAU,IAAI,GAAG,MAAM,WAAW,EAAE,QAAQ;;;;IAI1D,OAAO;;;EAGT,KAAK,MAAM,UAAS,UAAU;IAC5B,IAAI,CAAC,KAAK,UAAU,WAAW;MAC7B;;;IAGF,IAAM,OAAO,KAAK,IAAI,SAAS,UAAU,SAAS,MAAM;;IAExD,SAAS,MAAM;;IAEf,EAAE,QAAQ,SAAS,SAAS,WAAW,UAAS,GAAG,GAAG;MACpD,UAAU,IAAI,GAAG,MAAM,WAAW,EAAE,QAAQ;;;IAG9C,EAAE,QAAQ,SAAS,SAAS,WAAW,UAAS,GAAG,GAAG;MACpD,IAAM,WAAW,UAAU,IAAI;MAC/B,SAAS,MAAM,WAAW,EAAE;MAC5B,SAAS,QAAQ,EAAE;;;IAGrB;;;EAGF,KAAK,SAAS,UAAS,UAAU;IAC/B,IAAM,OAAO,KAAK,IAAI,SAAS,UAAU,SAAS,MAAM;;IAExD,EAAE,QAAQ,SAAS,SAAS,WAAW,UAAS,GAAG,GAAG;MACpD,IAAM,QAAQ,EAAE,QAAQ;MACxB,IAAM,WAAW,UAAU,IAAI;;MAE/B,EAAE,SAAS;MACX,EAAE,aAAa,SAAS,MAAM,WAAW;MACzC,EAAE,OAAO,SAAS;;;IAGpB,OAAO,EAAE,OAAO,SAAS,SAAS,WAAW;;;EAG/C,KAAK,gBAAgB,YAAW;IAC9B,IAAM,OAAO,SAAP,KAAgB,WAAW;MAC/B,EAAE,QAAQ,WAAW,UAAS,UAAU;QACtC,EAAE,QAAQ,SAAS,SAAS,WAAW,UAAS,GAAG,GAAG;UACpD,UAAU,IAAI,GAAG,QAAQ,SAAS,MAAM,UAAU,EAAE;;;;;IAK1D,KAAK,UAAU;IACf,KAAK,SAAS;;IAEf;AC1FL;;AAAA,QACG,OAAO,aACP,QAAQ,aAAa,YAAW;EAC/B,IAAM,YAAY;IAChB,QAAQ;MACN,MAAM;MACN,aAAa;MACb,OAAO;MACP,QAAQ;MACR,UAAU;MACV,OAAO,EAAE,SAAS,GAAG,KAAK,GAAG,OAAO;MACpC,UAAU;QACR,WAAW;UACT,SAAS,EAAE,OAAO;;;MAGtB,UAAU;QACR,WAAW;UACT,SAAS,EAAE,OAAO,GAAG,MAAM;;;;;;EAMnC,KAAK,MAAM,YAAW;IACpB,OAAO,EAAE,OAAO,WAAW;;;EAG7B,KAAK,MAAM,UAAS,KAAK;IACvB,OAAO,UAAU;;GAElB;AC/BL;;AAAA,QACG,OAAO,aACP,QAAQ,YAAY,YAAW;EAC9B,IAAM,WAAW;IACf,SAAS;MACP,MAAM;MACN,aAAa;MACb,OAAO;MACP,QAAQ;MACR,UAAU;MACV,OAAO,EAAE,SAAS,GAAG,KAAK,GAAG,OAAO;MACpC,UAAU;MACV,UAAU;QACR,WAAW;UACT,SAAS,EAAE,OAAO,GAAG,MAAM;;;;IAIjC,YAAY;MACV,MAAM;MACN,aAAa;MACb,OAAO;MACP,QAAQ;MACR,UAAU;MACV,OAAO,EAAE,SAAS,GAAG,KAAK,GAAG,OAAO;MACpC,UAAU;QACR,WAAW;UACT,QAAQ,EAAE,OAAO;;QAEnB,WAAW;UACT,SAAS,EAAE,OAAO,IAAI,MAAM;;;MAGhC,UAAU;QACR,WAAW;UACT,OAAO,EAAE,OAAO,GAAG,MAAM;UACzB,QAAQ,EAAE,OAAO,IAAI,MAAM;;;;;;EAMnC,KAAK,MAAM,YAAW;IACpB,OAAO,EAAE,OAAO,UAAU;;;EAG5B,KAAK,MAAM,UAAS,KAAK;IACvB,OAAO,SAAS;;GAEjB;ACjDL;;AAAA,QACG,OAAO,aACP,QAAQ,QAAQ,YAAW;EAC1B,IAAM,OAAO;IACX,OAAO;;;EAGT,KAAK,MAAM,YAAW;IACpB,OAAO;;GAER;ACVL;;AAAA,QACG,OAAO,aACP,QAAQ,aAAa,YAAW;EAC/B,IAAM,YAAY;IAChB,SAAS;MACP,MAAM;MACN,aAAa;MACb,OAAO,EAAE,SAAS,GAAG,OAAO;MAC5B,MAAM;;IAER,OAAO;MACL,MAAM;MACN,aAAa;MACb,OAAO,EAAE,SAAS,GAAG,OAAO;MAC5B,MAAM;;IAER,QAAQ;MACN,MAAM;MACN,aAAa;MACb,OAAO,EAAE,SAAS,GAAG,OAAO;MAC5B,MAAM;;;;EAIV,KAAK,MAAM,YAAW;IACpB,OAAO,EAAE,OAAO,WAAW;;;EAG7B,KAAK,MAAM,UAAS,KAAK;IACvB,OAAO,UAAU;;GAElB;AC/BL;;AAAA,QACG,OAAO,aACP,QAAQ,mFAAW,UAAS,WAAW,UAAU,MAAM,WAAW,UAAU,WAAW;EACtF,KAAK,OAAO,YAAW;IACrB,QAAQ,IAAI;IACZ,IAAI;MACJ,CAAC,YAAY;QAAX,IAAM,OAAO;UACX,SAAS;UACT,MAAM;UACN,WAAW;UACX,WAAW;;;QAGb,IAAM,gBAAgB,SAAhB,cAAyB,WAAW;UACxC,EAAE,QAAQ,WAAW,UAAS,GAAG,GAAG;YAClC,KAAK,UAAU,KAAK;cAClB,OAAO,EAAE;cACT,QAAQ,EAAE;;;;;QAKhB,IAAM,WAAW,SAAX,SAAoB,MAAM;UAC9B,KAAK,KAAK,QAAQ,KAAK;;;QAGzB,IAAM,gBAAgB,SAAhB,cAAyB,WAAW;UACxC,EAAE,QAAQ,WAAW,UAAS,GAAG,GAAG;YAClC,KAAK,UAAU,KAAK;cAClB,OAAO,EAAE;;;;;QAKf,SAAS,KAAK;QACd,cAAc,UAAU;QACxB,cAAc,UAAU;QACxB,cAAc,SAAS;;QAEvB,aAAa,QAAQ,SAAS,eAAe,KAAK,UAAU;;MAC5D,OAAM,KAAK;MACX,QAAQ,MAAM;;;;EAIlB,KAAK,OAAO,YAAW;IACrB,QAAQ,IAAI;IACZ,IAAI;MAGJ,CAAC,YAAY;QAFX,IAAM,OAAO,KAAK,MAAM,aAAa,QAAQ,SAAS;;QAEtD,KAAK,OAAO,KAAK,QAAQ;QACzB,KAAK,YAAY,KAAK,aAAa;QACnC,KAAK,YAAY,KAAK,aAAa;;QAEnC,IAAM,WAAW,SAAX,SAAoB,MAAM;UAC9B,KAAK,QAAQ,KAAK,KAAK,SAAS,KAAK;;;QAGvC,IAAM,gBAAgB,SAAhB,gBAA2B;UAC/B,EAAE,QAAQ,KAAK,WAAW,UAAS,GAAG,GAAG;YACvC,IAAM,WAAW,UAAU,IAAI;YAC/B,SAAS,QAAQ,EAAE;;;;QAIvB,IAAM,gBAAgB,SAAhB,gBAA2B;UAC/B,EAAE,QAAQ,KAAK,WAAW,UAAS,GAAG,GAAG;YACvC,IAAM,WAAW,UAAU,IAAI,MAAM,SAAS,IAAI;YAClD,SAAS,QAAQ,EAAE;YACnB,SAAS,SAAS,EAAE;;;;QAIxB,SAAS,KAAK;QACd;QACA;;MACA,OAAO,KAAK;MACZ,QAAQ,MAAM;;;IAGjB","file":"munchkins.js","sourcesContent":["'use strict';\n\nangular\n  .module('munchkins', ['ngRoute'])\n  .constant('Defaults', {\n    TICK_RATE: 250,\n    SAVE_RATE: 60000,\n    SAVE_LOCATION: 'munchkinsSave'\n  })\n  .config(function($routeProvider) {\n    $routeProvider\n      .when('/buildings', { templateUrl: 'views/buildings.html' })\n      .otherwise({ redirectTo: '/buildings' });\n  });\n","angular\n  .module('munchkins')\n  .controller('Buildings', function(Actions, Buildings) {\n    this.buildings = Buildings.all();\n\n    this.buy = Actions.buy;\n    this.isBuyable = Actions.isBuyable;\n    this.prices = Actions.prices;\n  });\n","angular\n  .module('munchkins')\n  .controller('Crafting', function(Actions, Crafting) {\n    this.crafting = Crafting.all();\n\n    this.buy = Actions.buy;\n    this.isBuyable = Actions.isBuyable;\n    this.prices = Actions.prices;\n  });\n","angular\n  .module('munchkins')\n  .controller('Game', function($interval, Defaults, Game, Actions, Resources, Storage) {\n    const tickloop = function() {\n      Game.all().ticks++;\n\n      const resources = Resources.all();\n      _.forEach(resources, function(resource) {\n        resource.value.current += resource.rate;\n        if (resource.value.limit) {\n          resource.value.current = Math.min(resource.value.current, resource.value.limit);\n        }\n      });\n    };\n\n    Storage.load();\n    Actions.initResources();\n\n    $interval(Storage.save, Defaults.SAVE_RATE);\n    $interval(tickloop, Defaults.TICK_RATE);\n  });\n","angular\n  .module('munchkins')\n  .controller('Log', function() {});\n","angular\n  .module('munchkins')\n  .controller('Resources', function(Resources) {\n    this.resources = Resources.all();\n  });\n","angular\n  .module('munchkins')\n  .filter('numeric', function() {\n    const units = ['', 'K', 'M', 'G', 'T', 'P'];\n\n    return function(number, precision) {\n      const n = number || 0;\n      const u = Math.floor(Math.log(n) / Math.log(1000));\n\n      let p = precision || ((precision === 0) ? 0 : 2);\n      if ((p === 0) && (p >= 1000)) {\n        p = 2;\n      }\n\n      return (n < 1) ? (n.toFixed(p)) : ((n / 1000 ** Math.floor(u)).toFixed(p) + units[u]);\n    };\n  });\n","angular\n  .module('munchkins')\n  .service('Actions', function(Buildings, Crafting, Resources) {\n    const unlockAll = function() {\n      const unlock = function(buildings) {\n        _.forEach(buildings, function(building) {\n          if (building.locked) {\n            building.locked = false;\n\n            _.forEach(building.requires.buildings, function(b, k) {\n              if (!building.locked) {\n                building.locked = !(Buildings.get(k).value.current >= b.value);\n              }\n            });\n\n            _.forEach(building.requires.resources, function(r, k) {\n              if (!building.locked) {\n                building.locked = !(Resources.get(k).value.current >= r.value);\n              }\n            });\n          }\n        });\n      };\n\n      unlock(Buildings.all());\n      unlock(Crafting.all());\n    };\n\n    this.isBuyable = function(building) {\n      const incr = Math.pow(building.increase, building.value.current);\n      let buyable = true;\n\n      _.forEach(building.requires.resources, function(r, k) {\n        if (buyable) {\n          buyable = Resources.get(k).value.current >= r.value * incr;\n        }\n      });\n\n      return buyable;\n    };\n\n    this.buy = function(building) {\n      if (!this.isBuyable(building)) {\n        return;\n      }\n\n      const incr = Math.pow(building.increase, building.value.current);\n\n      building.value.current++;\n\n      _.forEach(building.requires.resources, function(r, k) {\n        Resources.get(k).value.current -= r.value * incr;\n      });\n\n      _.forEach(building.provides.resources, function(p, k) {\n        const resource = Resources.get(k);\n        resource.value.current += p.value;\n        resource.rate += p.rate;\n      });\n\n      unlockAll();\n    };\n\n    this.prices = function(building) {\n      const incr = Math.pow(building.increase, building.value.current);\n\n      _.forEach(building.requires.resources, function(r, k) {\n        const price = r.value * incr;\n        const resource = Resources.get(k);\n\n        r.buynow = price;\n        r.affordable = resource.value.current >= price;\n        r.name = resource.name;\n      });\n\n      return _.filter(building.requires.resources, {});\n    };\n\n    this.initResources = function() {\n      const init = function(buildings) {\n        _.forEach(buildings, function(building) {\n          _.forEach(building.provides.resources, function(p, k) {\n            Resources.get(k).rate += building.value.current * p.rate;\n          });\n        });\n      };\n\n      init(Buildings.all());\n      init(Crafting.all());\n    };\n  });\n","angular\n  .module('munchkins')\n  .service('Buildings', function() {\n    const buildings = {\n      meadow: {\n        name: 'Flower Meadow',\n        description: 'A naturally growing field of flowers',\n        craft: false,\n        locked: true,\n        increase: 1.1,\n        value: { current: 0, max: 0, level: 0 },\n        requires: {\n          resources: {\n            flowers: { value: 100 }\n          }\n        },\n        provides: {\n          resources: {\n            flowers: { value: 0, rate: 0.01 }\n          }\n        }\n      }\n    };\n\n    this.all = function() {\n      return _.filter(buildings, {});\n    };\n\n    this.get = function(key) {\n      return buildings[key];\n    };\n  });\n","angular\n  .module('munchkins')\n  .service('Crafting', function() {\n    const crafting = {\n      collect: {\n        name: 'Collect Flowers',\n        description: 'Flowers are the staple of the Munchkin diet, collect them',\n        craft: true,\n        locked: false,\n        increase: 1.0,\n        value: { current: 0, max: 0, level: 0 },\n        requires: {},\n        provides: {\n          resources: {\n            flowers: { value: 1, rate: 0 }\n          }\n        }\n      },\n      processing: {\n        name: 'Process Flowers',\n        description: 'Processes flowers into petals and stems',\n        craft: true,\n        locked: true,\n        increase: 1.0,\n        value: { current: 0, max: 0, level: 0 },\n        requires: {\n          buildings: {\n            meadow: { value: 1 }\n          },\n          resources: {\n            flowers: { value: 10, rate: 0 }\n          }\n        },\n        provides: {\n          resources: {\n            stems: { value: 9, rate: 0 },\n            petals: { value: 75, rate: 0 }\n          }\n        }\n      }\n    };\n\n    this.all = function() {\n      return _.filter(crafting, {});\n    };\n\n    this.get = function(key) {\n      return crafting[key];\n    };\n  });\n","angular\n  .module('munchkins')\n  .service('Game', function() {\n    const game = {\n      ticks: 0\n    };\n\n    this.all = function() {\n      return game;\n    };\n  });\n","angular\n  .module('munchkins')\n  .service('Resources', function() {\n    const resources = {\n      flowers: {\n        name: 'Flowers',\n        description: 'Flowers are the staple of the Munchkin diet',\n        value: { current: 0, limit: 0 },\n        rate: 0\n      },\n      stems: {\n        name: 'Stems',\n        description: 'Flower stems act as a basic building block',\n        value: { current: 0, limit: 0 },\n        rate: 0\n      },\n      petals: {\n        name: 'Petals',\n        description: 'Flower petals are a decoration with various uses',\n        value: { current: 0, limit: 0 },\n        rate: 0\n      }\n    };\n\n    this.all = function() {\n      return _.filter(resources, {});\n    };\n\n    this.get = function(key) {\n      return resources[key];\n    };\n  });\n","angular\n  .module('munchkins')\n  .service('Storage', function($interval, Defaults, Game, Buildings, Crafting, Resources) {\n    this.save = function() {\n      console.log('Saving game');\n      try {\n        const save = {\n          version: 1,\n          game: {},\n          resources: {},\n          buildings: {}\n        };\n\n        const saveBuildings = function(buildings) {\n          _.forEach(buildings, function(b, k) {\n            save.buildings[k] = {\n              value: b.value,\n              locked: b.locked\n            };\n          });\n        };\n\n        const saveGame = function(game) {\n          save.game.ticks = game.ticks;\n        };\n\n        const saveResources = function(resources) {\n          _.forEach(resources, function(r, k) {\n            save.resources[k] = {\n              value: r.value\n            };\n          });\n        };\n\n        saveGame(Game.all());\n        saveResources(Resources.all());\n        saveBuildings(Buildings.all());\n        saveBuildings(Crafting.all());\n\n        localStorage.setItem(Defaults.SAVE_LOCATION, JSON.stringify(save));\n      } catch(err) {\n        console.error(err);\n      }\n    };\n\n    this.load = function() {\n      console.log('Loading game');\n      try {\n        const load = JSON.parse(localStorage.getItem(Defaults.SAVE_LOCATION));\n\n        load.game = load.game || {};\n        load.resources = load.resources || {};\n        load.buildings = load.buildings || {};\n\n        const loadGame = function(game) {\n          game.ticks = load.game.ticks || game.ticks;\n        };\n\n        const loadResources = function() {\n          _.forEach(load.resources, function(r, k) {\n            const resource = Resources.get(k);\n            resource.value = r.value;\n          });\n        };\n\n        const loadBuildings = function() {\n          _.forEach(load.buildings, function(b, k) {\n            const building = Buildings.get(k) || Crafting.get(k);\n            building.value = b.value;\n            building.locked = b.locked;\n          });\n        };\n\n        loadGame(Game.all());\n        loadResources();\n        loadBuildings();\n      } catch (err) {\n        console.error(err);\n      }\n    };\n  });\n"],"sourceRoot":"."}