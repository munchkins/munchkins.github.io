{"version":3,"sources":["app.js","controllers/buildings.js","controllers/crafting.js","controllers/game.js","controllers/log.js","controllers/resources.js","controllers/subbar.js","controllers/topbar.js","controllers/tribe.js","filters/numeric.js","services/actions.js","services/buildings.js","services/crafting.js","services/game.js","services/resources.js","services/tribe.js"],"names":[],"mappings":"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","file":"munchkins.js","sourcesContent":["'use strict';\n\nangular\n  .module('munchkins', ['ngRoute'])\n  .constant('Defaults', {\n    TICK_RATE: 250,\n    SAVE_RATE: 60000,\n    SAVE_LOCATION: 'munchkinsSave'\n  })\n  .config(function($routeProvider) {\n    $routeProvider\n      .when('/buildings', { templateUrl: 'views/buildings.html' })\n      .when('/tribe', { templateUrl: 'views/tribe.html' })\n      .otherwise({ redirectTo: '/buildings' });\n  });\n","angular\n  .module('munchkins')\n  .controller('Buildings', function(Actions, Buildings) {\n    this.buildings = Buildings.all();\n\n    this.buy = Actions.buy;\n    this.isBuyable = Actions.isBuyable;\n    this.prices = Actions.prices;\n  });\n","angular\n  .module('munchkins')\n  .controller('Crafting', function(Actions, Crafting) {\n    this.crafting = Crafting.all();\n\n    this.buy = Actions.buy;\n    this.isBuyable = Actions.isBuyable;\n    this.prices = Actions.prices;\n  });\n","angular\n  .module('munchkins')\n  .controller('Game', function() {});\n","angular\n  .module('munchkins')\n  .controller('Log', function() {});\n","angular\n  .module('munchkins')\n  .controller('Resources', function(Resources) {\n    this.resources = Resources.all();\n  });\n","angular\n  .module('munchkins')\n  .controller('Subbar', function($location, Buildings, Tribe) {\n    this.totalTribe = Tribe.total;\n    this.totalBuildings = Buildings.activeTotal;\n\n    this.isOn = function(path) {\n      return $location.path() === path;\n    };\n  });\n","angular\n  .module('munchkins')\n  .controller('Topbar', function(Game) {\n    this.save = Game.save;\n    this.calendar = Game.calendar;\n  });\n","angular\n  .module('munchkins')\n  .controller('Tribe', function(Tribe) {\n    this.total = Tribe.total;\n  });\n","angular\n  .module('munchkins')\n  .filter('numeric', function() {\n    const units = ['', 'K', 'M', 'G', 'T', 'P'];\n\n    return function(number, precision) {\n      const n = number || 0;\n      const u = Math.floor(Math.log(n) / Math.log(1000));\n\n      let p = precision || ((precision === 0) ? 0 : 2);\n      if ((p === 0) && (p >= 1000)) {\n        p = 2;\n      }\n\n      return (n < 1) ? (n.toFixed(p)) : ((n / 1000 ** Math.floor(u)).toFixed(p) + units[u]);\n    };\n  });\n","angular\n  .module('munchkins')\n  .service('Actions', function(Buildings, Crafting, Resources, Tribe) {\n    const unlockAll = function() {\n      const unlock = function(buildings) {\n        _.forEach(buildings, function(building) {\n          if (building.locked) {\n            let locked = false;\n\n            _.forEach(building.requires.buildings, function(b, k) {\n              if (!locked) {\n                locked = !(Buildings.get(k).value.current >= b.value);\n              }\n            });\n\n            _.forEach(building.requires.resources, function(r, k) {\n              if (!locked) {\n                building.locked = !(Resources.get(k).value.current >= r.value);\n              }\n            });\n\n            if (!locked) {\n              Buildings.activate(building);\n            }\n          }\n        });\n      };\n\n      unlock(Buildings.all());\n      unlock(Crafting.all());\n    };\n\n    this.isBuyable = function(building) {\n      const incr = Math.pow(building.increase, building.value.current);\n      let buyable = true;\n\n      _.forEach(building.requires.resources, function(r, k) {\n        if (buyable) {\n          buyable = Resources.get(k).value.current >= r.value * incr;\n        }\n      });\n\n      return buyable;\n    };\n\n    this.buy = function(building) {\n      if (!this.isBuyable(building)) {\n        return;\n      }\n\n      const incr = Math.pow(building.increase, building.value.current);\n\n      building.value.current++;\n\n      _.forEach(building.requires.resources, function(r, k) {\n        Resources.get(k).value.current -= r.value * incr;\n      });\n\n      _.forEach(building.provides.resources, function(p, k) {\n        const resource = Resources.get(k);\n        resource.value.current += p.value;\n        resource.rate += p.rate;\n      });\n\n      Tribe.add(building.provides.tribe || 0);\n\n      unlockAll();\n    };\n\n    this.prices = function(building) {\n      const incr = Math.pow(building.increase, building.value.current);\n\n      _.forEach(building.requires.resources, function(r, k) {\n        const price = r.value * incr;\n        const resource = Resources.get(k);\n\n        r.buynow = price;\n        r.affordable = resource.value.current >= price;\n        r.name = resource.name;\n      });\n\n      return _.filter(building.requires.resources, {});\n    };\n\n    this.initResources = function() {\n      const init = function(buildings) {\n        _.forEach(buildings, function(building) {\n          _.forEach(building.provides.resources, function(p, k) {\n            Resources.get(k).rate += building.value.current * p.rate;\n          });\n        });\n      };\n\n      init(Buildings.all());\n      init(Crafting.all());\n    };\n  });\n","angular\n  .module('munchkins')\n  .service('Buildings', function() {\n    const buildings = {\n      meadow: {\n        name: 'Flower Meadow',\n        description: 'A naturally growing field of flowers',\n        locked: true,\n        increase: 1.1,\n        value: { current: 0, max: 0, level: 0 },\n        requires: {\n          resources: {\n            flowers: { value: 100 }\n          }\n        },\n        provides: {\n          resources: {\n            flowers: { value: 0, rate: 0.01 }\n          }\n        }\n      },\n      shelter: {\n        name: 'Shelter',\n        description: 'A basic shelter made from flower stems',\n        locked: true,\n        increase: 1.1,\n        value: { current: 0, max: 0, level: 0 },\n        requires: {\n          resources: {\n            stems: { value: 100 }\n          }\n        },\n        provides: {\n          tribe: 1\n        }\n      }\n    };\n\n    let activeTotal = 0;\n    this.activeTotal = function() {\n      return activeTotal;\n    };\n\n    this.activate = function(building) {\n      activeTotal++;\n      building.locked = false;\n    };\n\n    this.all = function() {\n      return _.filter(buildings, {});\n    };\n\n    this.get = function(key) {\n      return buildings[key];\n    };\n\n    this.save = function(to) {\n      _.forEach(buildings, function(b, k) {\n        to[k] = {\n          value: b.value,\n          locked: b.locked\n        };\n      });\n    };\n\n    this.load = function(from) {\n      _.forEach(from, function(b, k) {\n        const building = buildings[k];\n\n        building.value = b.value;\n        building.locked = b.locked;\n        if (!building.locked) {\n          activeTotal++;\n        }\n      });\n    };\n  });\n","angular\n  .module('munchkins')\n  .service('Crafting', function() {\n    const crafting = {\n      collect: {\n        name: 'Collect Flowers',\n        description: 'Flowers are the staple of the Munchkin diet, collect them',\n        locked: false,\n        increase: 1.0,\n        value: { current: 0, max: 0, level: 0 },\n        requires: {},\n        provides: {\n          resources: {\n            flowers: { value: 1, rate: 0 }\n          }\n        }\n      },\n      processing: {\n        name: 'Process Flowers',\n        description: 'Processes flowers into petals and stems',\n        locked: true,\n        increase: 1.0,\n        value: { current: 0, max: 0, level: 0 },\n        requires: {\n          buildings: {\n            meadow: { value: 1 }\n          },\n          resources: {\n            flowers: { value: 10, rate: 0 }\n          }\n        },\n        provides: {\n          resources: {\n            stems: { value: 9, rate: 0 },\n            petals: { value: 75, rate: 0 }\n          }\n        }\n      }\n    };\n\n    this.all = function() {\n      return _.filter(crafting, {});\n    };\n\n    this.get = function(key) {\n      return crafting[key];\n    };\n\n    this.save = function(to) {\n      _.forEach(crafting, function(c, k) {\n        to[k] = {\n          value: c.value,\n          locked: c.locked\n        };\n      });\n    };\n\n    this.load = function(from) {\n      _.forEach(from, function(c, k) {\n        const craft = crafting[k];\n        craft.value = c.value;\n        craft.locked = c.locked;\n      });\n    };\n  });\n","angular\n  .module('munchkins')\n  .service('Game', function($interval, Actions, Buildings, Crafting, Defaults, Resources, Tribe) {\n    const game = {\n      ticks: 0,\n      calendar: {\n        day: 0,\n        season: 0,\n        year: 0\n      }\n    };\n\n    const DAY_TICKS = 4 * 60;\n    const SEASON_DAYS = 98;\n    const YEAR_DAYS = 4 * SEASON_DAYS;\n\n    const tick = function() {\n      game.ticks++;\n\n      const days = Math.floor(game.ticks / DAY_TICKS);\n      game.calendar.year = Math.floor(days / YEAR_DAYS);\n      game.calendar.season = Math.floor((days % YEAR_DAYS) / SEASON_DAYS);\n      game.calendar.day = (days % YEAR_DAYS) % SEASON_DAYS;\n\n      const resources = Resources.all();\n      _.forEach(resources, function(resource) {\n        resource.value.current += resource.rate;\n        if (resource.value.limit) {\n          resource.value.current = Math.min(resource.value.current, resource.value.limit);\n        }\n      });\n    };\n\n    this.calendar = function() {\n      return game.calendar;\n    };\n\n    this.save = function() {\n      console.log('Saving game');\n      try {\n        const save = {\n          version: 1,\n          game: {\n            ticks: game.ticks\n          },\n          buildings: {},\n          crafting: {},\n          resources: {},\n          tribe: {}\n        };\n\n        Buildings.save(save.buildings);\n        Crafting.save(save.crafting);\n        Resources.save(save.resources);\n        Tribe.save(save.tribe);\n\n        localStorage.setItem(Defaults.SAVE_LOCATION, JSON.stringify(save));\n      } catch(err) {\n        console.error(err);\n      }\n    };\n\n    this.load = function() {\n      console.log('Loading game');\n      try {\n        const load = JSON.parse(localStorage.getItem(Defaults.SAVE_LOCATION)) || {};\n\n        game.ticks = (load.game || {}).ticks || game.ticks;\n\n        Buildings.load(load.buildings || {});\n        Crafting.load(load.crafting || {});\n        Resources.load(load.resources || {});\n        Tribe.load(load.tribe || {});\n      } catch (err) {\n        console.error(err);\n      }\n    };\n\n    this.load();\n    Actions.initResources();\n\n    $interval(this.save, Defaults.SAVE_RATE);\n    $interval(tick, Defaults.TICK_RATE);\n  });\n","angular\n  .module('munchkins')\n  .service('Resources', function() {\n    const resources = {\n      flowers: {\n        name: 'Flowers',\n        description: 'Flowers are the staple of the Munchkin diet',\n        value: { current: 0, limit: 0 },\n        rate: 0\n      },\n      stems: {\n        name: 'Stems',\n        description: 'Flower stems act as a basic building block',\n        value: { current: 0, limit: 0 },\n        rate: 0\n      },\n      petals: {\n        name: 'Petals',\n        description: 'Flower petals are a decoration with various uses',\n        value: { current: 0, limit: 0 },\n        rate: 0\n      }\n    };\n\n    this.all = function() {\n      return _.filter(resources, {});\n    };\n\n    this.get = function(key) {\n      return resources[key];\n    };\n\n    this.save = function(to) {\n      _.forEach(resources, function(r, k) {\n        to[k] = {\n          value: r.value\n        };\n      });\n    };\n\n    this.load = function(from) {\n      _.forEach(from, function(r, k) {\n        resources[k].value = r.value;\n      });\n    };\n  });\n","angular\n  .module('munchkins')\n  .service('Tribe', function() {\n    const tribe = {\n      free: 0\n    };\n\n    this.add = function(number) {\n      tribe.free += number;\n    };\n\n    this.total = function() {\n      return tribe.free;\n    };\n\n    this.save = function(to) {\n      to.free = tribe.free;\n    };\n\n    this.load = function(from) {\n      tribe.free = from.free || tribe.free;\n    };\n  });\n"],"sourceRoot":"."}