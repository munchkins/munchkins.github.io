{"version":3,"sources":["app.js","controllers/buildings.js","controllers/game.js","controllers/resources.js","services/storage.js","values/buildings.js","values/game.js","values/resources.js"],"names":["angular","module","constant","TICK_RATE","SAVE_RATE","SAVE_LOCATION","config","$routeProvider","when","templateUrl","otherwise","redirectTo","controller","Buildings","Resources","this","buildings","buy","key","b","value","current","forEach","requires","resources","req","rkey","r","provides","prov","pkey","rate","$interval","Defaults","Game","Storage","tickloop","ticks","res","console","log","load","save","service","version","game","bld","unlocked","localStorage","setItem","JSON","stringify","err","error","parse","getItem","collectFlowers","name","description","increase","max","level","flowers","limit"],"mappings":"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","file":"munchkins.js","sourcesContent":["'use strict';\n\nangular\n  .module('munchkins', ['ngRoute'])\n  .constant('Defaults', {\n    TICK_RATE: 250,\n    SAVE_RATE: 60000,\n    SAVE_LOCATION: 'munchkinsSave'\n  })\n  .config(function($routeProvider) {\n    $routeProvider\n      .when('/buildings', { templateUrl: 'views/buildings.html' })\n      .otherwise({ redirectTo: '/buildings' });\n  });\n","angular\n  .module('munchkins')\n  .controller('Buildings', function(Buildings, Resources) {\n    this.buildings = Buildings;\n\n    this.buy = function(key) {\n      const b = Buildings[key];\n      b.value.current++;\n\n      angular.forEach(b.requires.resources, function(req, rkey) {\n        const r = Resources[rkey];\n        r.value.current -= req.value;\n      });\n\n      angular.forEach(b.provides.resources, function(prov, pkey) {\n        const r = Resources[pkey];\n        r.value.current++;\n        r.rate += prov.rate;\n      });\n    };\n  });\n","angular\n  .module('munchkins')\n  .controller('Game', function($interval, Defaults, Game, Buildings, Resources, Storage) {\n    const tickloop = function() {\n      Game.ticks++;\n\n      angular.forEach(Resources, function(key, res) {\n        console.log(key, res);\n        res.value.current += res.rate;\n      });\n    };\n\n    Storage.load();\n    $interval(Storage.save, Defaults.SAVE_RATE);\n    $interval(tickloop, Defaults.TICK_RATE);\n  });\n","angular\n  .module('munchkins')\n  .controller('Resources', function(Resources) {\n    this.resources = Resources;\n  });\n","angular\n  .module('munchkins')\n  .service('Storage', function($interval, Defaults, Game, Resources, Buildings) {\n    this.save = function() {\n      console.log('Saving game');\n      try {\n        const save = {\n          version: 1,\n          game: 0,\n          resources: {},\n          buildings: {}\n        };\n\n        save.game.ticks = Game.ticks;\n\n        angular.forEach(Resources, function(res, key) {\n          save.resources[key] = {\n            value: res.value\n          };\n        });\n\n        angular.forEach(Buildings, function(bld, key) {\n          save.buildings[key] = {\n            value: bld.value,\n            unlocked: bld.unlocked\n          };\n        });\n\n        localStorage.setItem(Defaults.SAVE_LOCATION, JSON.stringify(save));\n      } catch(err) {\n        console.error(err);\n      }\n    };\n\n    this.load = function() {\n      console.log('Loading game');\n      try {\n        const load = JSON.parse(localStorage.getItem(Defaults.SAVE_LOCATION));\n\n        load.game = load.game || {};\n        load.resources = load.resources || {};\n        load.buildings = load.buildings || {};\n\n        Game.ticks = load.game.ticks || Game.ticks;\n\n        angular.forEach(load.resources, function(res, key) {\n          Resources[key].value = res.value;\n        });\n\n        angular.forEach(load.buildings, function(bld, key) {\n          Buildings[key].value = bld.value;\n          Buildings[key].unlocked = bld.unlocked;\n        });\n      } catch (err) {\n        console.error(err);\n      }\n    };\n  });\n","/*\n  Buildings are defined with the following structure\n\n  <key>: {\n    name: <string name>\n    description: <string description>\n    unlocked: <true|false>\n    increase: <base price increase>\n    value: {\n      current: <current value>\n      limit: <max value, 0 if no limit>\n      level: <upgrade level>\n    }\n    requires: {\n      resources: {\n        <resource key>: {\n          value: <number>\n        }\n      }\n    }\n    provides: {\n      resources: {\n        <resource key>: {\n          value: <number>\n          rate: <number>\n        }\n      }\n    }\n  }\n*/\nangular\n  .module('munchkins')\n  .value('Buildings', {\n    collectFlowers: {\n      name: 'Collect Flowers',\n      description: 'Flowers are the staple of the Munchkin diet, collect them',\n      unlocked: true,\n      increase: 0,\n      value: {\n        current: 0,\n        max: 0,\n        level: 0\n      },\n      requires: {\n      },\n      provides: {\n        resources: {\n          flowers: {\n            value: 1,\n            rate: 0\n          }\n        }\n      }\n    }\n  });\n","angular\n  .module('munchkins')\n  .value('Game', {\n    ticks: 0\n  });\n","/*\n  Resources are defined with the following structure\n\n  <key>: {\n    name: <string name>\n    description: <string description>\n    value: {\n      current: <current value>\n      max: <max value>\n    }\n    rate: <rate of increase>\n  }\n*/\nangular\n  .module('munchkins')\n  .value('Resources', {\n    flowers: {\n      name: 'Flowers',\n      description: 'Flowers are the staple of the Munchkin diet',\n      value: {\n        current: 0,\n        limit: 0\n      },\n      rate: 0\n    }\n  });\n"],"sourceRoot":"."}